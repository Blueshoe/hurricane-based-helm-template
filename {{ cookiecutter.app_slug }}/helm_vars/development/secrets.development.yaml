{% macro random_char(len) -%}
  {% for n in range(len) %}
    {{- cookiecutter.__alphabet|random -}}
  {% endfor %}
{%- endmacro -%}

{% macro gen_secret(group_len=6) -%}
  {% set parts %}
      {{- random_char(group_len) -}}
  {% endset %}
  {{- parts|join("") -}}
{%- endmacro -%}

{% set image_parts = cookiecutter.image_repo.split("/") -%}
imageCredentials:
    registry: {{ image_parts.0 }}
    username: {{ cookiecutter.registry_username }}
    password: {{ cookiecutter.registry_password }}
secretEnvironmentVariables:
    DJANGO_SECRET_KEY: {{ gen_secret(85) }}
    DJANGO_USE_S3: "False"
    DJANGO_AWS_S3_ACCESS_KEY_ID: "set-me"
    DJANGO_AWS_S3_SECRET_ACCESS_KEY: "set-me"
    DJANGO_AWS_S3_BUCKET_NAME: "set-me"
    DJANGO_AWS_REGION: "set-me"
postgresql:
    postgresqlDatabase: {{ cookiecutter.app_slug }}
    postgresqlPassword: {{ gen_secret(6) }}
{% if cookiecutter.use_rabbitmq == "yes" -%}
rabbitmq:
    host: {{ cookiecutter.app_slug }}-rabbitmq
    vhost: /
    password: {{ gen_secret(32) }}
{% endif %}
